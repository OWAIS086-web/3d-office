<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Admin Command Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="{{ url_for('static', filename='js/futuristic-alerts.js') }}"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 30%, #16213e 70%, #0f3460 100%);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .dashboard-container {
            position: relative;
            perspective: 2000px;
            padding: 20px;
            min-height: 100vh;
        }

        /* Floating particles background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        /* Holographic scan lines */
        .scan-lines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 255, 0.03) 2px,
                rgba(0, 255, 255, 0.03) 4px
            );
            animation: scan-move 10s linear infinite;
        }

        @keyframes scan-move {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(0, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 8s infinite linear;
            box-shadow: 0 0 6px rgba(0, 255, 255, 0.8);
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-10vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 10;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #00ff88, #00aaff, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            color: #00aaff;
        }

        /* Admin Navigation */
        .admin-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 10;
        }

        .nav-items {
            display: flex;
            gap: 5px;
            background: rgba(0, 40, 60, 0.3);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 10px;
            backdrop-filter: blur(15px);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 15px 20px;
            border-radius: 10px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-width: 80px;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover {
            color: #00aaff;
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-item.active {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .nav-item.logout {
            margin-left: 20px;
        }

        .nav-item.logout:hover {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.2);
        }

        .nav-item i {
            font-size: 1.2rem;
        }

        .nav-item span {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Control Panel */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00aaff;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .control-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Status Legend */
        .status-legend {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
            position: relative;
            z-index: 10;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .legend-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.2);
        }

        .legend-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            box-shadow: 0 0 15px currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .online { color: #00ff88; }
        .break { color: #00aaff; }
        .offline { color: #ff4444; }

        /* Main Grid Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Left Panel - Stats */
        .stats-panel {
            background: rgba(0, 40, 60, 0.3);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            height: fit-content;
        }

        .stats-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            animation: scan 4s infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .stats-title {
            font-size: 1.8rem;
            color: #00aaff;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 15px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateX(5px);
            background: rgba(0, 0, 0, 0.4);
        }

        .stat-item.total { border-left-color: #00aaff; }
        .stat-item.online { border-left-color: #00ff88; }
        .stat-item.break { border-left-color: #00aaff; }
        .stat-item.offline { border-left-color: #ff4444; }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 0 0 15px currentColor;
        }

        /* Right Panel - Department Grid */
        .departments-container {
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }

        .departments-title {
            font-size: 1.8rem;
            color: #00aaff;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }

        .department-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .department-panel {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.4s ease;
            cursor: pointer;
            overflow: hidden;
        }

        .department-panel:hover {
            transform: rotateY(5deg) rotateX(2deg) translateZ(15px);
            box-shadow: 0 25px 50px rgba(0, 255, 255, 0.3);
            border-color: rgba(0, 255, 255, 0.6);
        }

        .department-panel::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                rgba(0, 255, 255, 0.2), 
                rgba(0, 255, 136, 0.2), 
                rgba(0, 170, 255, 0.2), 
                rgba(0, 255, 255, 0.2));
            border-radius: 15px;
            z-index: -1;
            animation: border-glow 3s ease-in-out infinite;
        }

        @keyframes border-glow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        .department-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #00aaff;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 8px rgba(0, 170, 255, 0.5);
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .employee-desk {
            width: 120px;
            height: 100px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .desk-container {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
        }

        .desk-container:hover {
            transform: scale(1.1) rotateY(5deg);
        }

        /* 3D Desk */
        .desk {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 40px;
            background: linear-gradient(135deg, #8B4513, #A0522D);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .desk::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            height: 6px;
            background: linear-gradient(135deg, #A0522D, #CD853F);
            border-radius: 8px 8px 0 0;
        }

        /* Computer Monitor */
        .monitor {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 20px;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            border-radius: 2px;
            border: 1px solid #1ABC9C;
        }

        .monitor::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            background: #34495E;
            border-radius: 0 0 4px 4px;
        }

        /* Cartoon Avatar */
        .avatar {
            position: absolute;
            bottom: 25px;
            right: 15px;
            width: 35px;
            height: 45px;
            transition: all 0.3s ease;
        }

        /* Avatar Head */
        .avatar-head {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FDBCB4;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        .avatar-face {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .avatar-initials {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            color: #333;
        }

        /* Avatar Body */
        .avatar-body {
            width: 16px;
            height: 25px;
            border-radius: 8px 8px 4px 4px;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid;
        }

        /* Status-based coloring */
        .employee-desk.online .avatar-head {
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
        }

        .employee-desk.online .avatar-body {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
        }

        .employee-desk.online .monitor {
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .employee-desk.break .avatar-head {
            border-color: #00aaff;
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.8);
        }

        .employee-desk.break .avatar-body {
            background: linear-gradient(135deg, #00aaff, #0088cc);
            border-color: #00aaff;
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.6);
        }

        .employee-desk.break .monitor {
            border-color: #00aaff;
            box-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }

        .employee-desk.offline .avatar-head {
            border-color: #ff4444;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.8);
        }

        .employee-desk.offline .avatar-body {
            background: linear-gradient(135deg, #ff4444, #cc3333);
            border-color: #ff4444;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.6);
        }

        .employee-desk.offline .monitor {
            border-color: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
        }

        /* Chair */
        .chair {
            position: absolute;
            bottom: 15px;
            right: 25px;
            width: 15px;
            height: 20px;
            background: linear-gradient(135deg, #34495E, #2C3E50);
            border-radius: 3px;
        }

        .chair::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 0;
            width: 15px;
            height: 12px;
            background: linear-gradient(135deg, #34495E, #2C3E50);
            border-radius: 3px 3px 0 0;
        }

        /* Keyboard */
        .keyboard {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 8px;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            border-radius: 2px;
            border: 1px solid #1ABC9C;
        }

        /* Mouse */
        .mouse {
            position: absolute;
            bottom: 30px;
            right: 20px;
            width: 6px;
            height: 10px;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            border-radius: 3px;
            border: 1px solid #1ABC9C;
        }

        /* Status Indicator Light */
        .status-light {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse-light 2s ease-in-out infinite;
        }

        .employee-desk.online .status-light {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .employee-desk.break .status-light {
            background: #00aaff;
            box-shadow: 0 0 10px #00aaff;
        }

        .employee-desk.offline .status-light {
            background: #ff4444;
            box-shadow: 0 0 10px #ff4444;
        }

        @keyframes pulse-light {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        .employee-avatar:hover {
            transform: scale(1.2) translateZ(15px);
            z-index: 100;
        }

        .employee-tooltip {
            position: absolute;
            bottom: -80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(0, 255, 255, 0.4);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            text-align: left;
        }

        .employee-desk:hover .employee-tooltip {
            opacity: 1;
        }

        /* Holographic Grid Effect */
        .department-panel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
            border-radius: 15px;
        }

        /* Floating Animation for Desks */
        @keyframes float-desk {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        .employee-desk:hover .desk-container {
            animation: float-desk 2s ease-in-out infinite;
        }

        /* Pulsing Monitor Effect */
        @keyframes pulse-monitor {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .employee-desk.online .monitor {
            animation: pulse-monitor 2s ease-in-out infinite;
        }

        /* Notification Panel */
        .notification-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(15px);
            z-index: 1000;
            overflow-y: auto;
        }

        .notification-title {
            color: #00aaff;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .send-notification-btn {
            width: 100%;
            background: linear-gradient(135deg, #00ff88, #00aaff);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .send-notification-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
        }

        /* Real-time indicator */
        .live-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            border-radius: 25px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            z-index: 1000;
        }

        .live-dot {
            width: 12px;
            height: 12px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #00ff88, #00aaff);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #00aaff, #00ff88);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        /* Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: #00aaff rgba(0, 0, 0, 0.3);
        }

        /* Notification animations */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Broadcast Modal */
        .broadcast-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .broadcast-modal-content {
            background: rgba(0, 40, 60, 0.95);
            border: 2px solid rgba(0, 255, 255, 0.4);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .broadcast-modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            animation: scan 4s infinite;
        }

        .broadcast-header {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
        }

        .broadcast-header h3 {
            color: #00aaff;
            font-size: 1.4rem;
            margin: 0;
            text-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }

        .close-btn {
            background: none;
            border: none;
            color: #ff4444;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            background: rgba(255, 68, 68, 0.2);
            transform: rotate(90deg);
        }

        .broadcast-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #00aaff;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
            resize: vertical;
        }

        .form-control:focus {
            outline: none;
            border-color: #00aaff;
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.4);
            background: rgba(0, 0, 0, 0.6);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .broadcast-footer {
            padding: 20px 30px;
            border-top: 1px solid rgba(0, 255, 255, 0.3);
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            background: rgba(0, 0, 0, 0.3);
        }

        .btn-cancel {
            padding: 12px 25px;
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid rgba(255, 68, 68, 0.4);
            color: #ff4444;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: rgba(255, 68, 68, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 68, 68, 0.3);
        }

        .btn-broadcast {
            padding: 12px 25px;
            background: linear-gradient(135deg, #00ff88, #00aaff);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-broadcast:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.4);
        }

        .btn-broadcast::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-broadcast:hover::before {
            left: 100%;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .department-grid {
                grid-template-columns: 1fr;
            }
            
            .status-legend {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .control-panel {
                position: relative;
                top: auto;
                right: auto;
                justify-content: center;
                margin-bottom: 20px;
            }
            
            .notification-panel {
                position: relative;
                bottom: auto;
                right: auto;
                width: 100%;
                margin-top: 20px;
            }
        }

        /* Floating Office Layout Button */
        .floating-office-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        .floating-office-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(255, 215, 0, 0.6);
            color: #000;
            text-decoration: none;
        }

        .floating-office-btn i {
            font-size: 1.5rem;
            margin-bottom: 2px;
        }

        @media (max-width: 768px) {
            .floating-office-btn {
                width: 60px;
                height: 60px;
                font-size: 0.7rem;
            }

            .floating-office-btn i {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Floating Particles -->
        <div class="particles" id="particles"></div>
        
        <!-- Holographic Scan Lines -->
        <div class="scan-lines"></div>
        
        <!-- Live Indicator -->
        <div class="live-indicator">
            <div class="live-dot"></div>
            <span>LIVE</span>
        </div>
        
        <!-- Control Panel -->
        <div class="control-panel">
            <button class="control-btn" onclick="showBroadcastAlert()">
                <i class="fas fa-broadcast-tower"></i> Quick Alert
            </button>
            <button class="control-btn" onclick="toggleAutoRefresh()">
                <i class="fas fa-pause" id="refreshIcon"></i> <span id="refreshText">Pause</span>
            </button>
        </div>

        <!-- Broadcast Alert Popup -->
        <div id="broadcastModal" class="broadcast-modal" style="display: none;">
            <div class="broadcast-modal-content">
                <div class="broadcast-header">
                    <h3><i class="fas fa-broadcast-tower"></i> QUICK BROADCAST ALERT</h3>
                    <button class="close-btn" onclick="closeBroadcastAlert()">&times;</button>
                </div>
                <div class="broadcast-body">
                    <div class="form-group">
                        <label>Alert Type</label>
                        <select id="alertType" class="form-control">
                            <option value="info">Information</option>
                            <option value="warning">Warning</option>
                            <option value="urgent">Urgent</option>
                            <option value="emergency">Emergency</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Message</label>
                        <textarea id="alertMessage" class="form-control" rows="4" placeholder="Enter your broadcast message..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Target</label>
                        <select id="alertTarget" class="form-control">
                            <option value="all">All Employees</option>
                            {% for department in departments %}
                            <option value="{{ department }}">{{ department }} Department</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="broadcast-footer">
                    <button class="btn-cancel" onclick="closeBroadcastAlert()">Cancel</button>
                    <button class="btn-broadcast" onclick="sendBroadcastAlert()">
                        <i class="fas fa-satellite-dish"></i> Broadcast Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Department Selector (Left Side) -->
        <div style="position: fixed; left: 20px; top: 50%; transform: translateY(-50%); z-index: 1000;">
            {% for department in departments %}
            <div class="dept-selector" onclick="focusDepartment('{{ department }}')" 
                 style="margin: 15px 0; padding: 0; background: rgba(0, 40, 60, 0.3); 
                        border: 2px solid rgba(0, 255, 255, 0.4); border-radius: 50%; 
                        width: 90px; height: 90px; display: flex; flex-direction: column;
                        align-items: center; justify-content: center; cursor: pointer; 
                        transition: all 0.3s ease; font-size: 0.7rem; text-align: center; 
                        color: #00aaff; backdrop-filter: blur(10px);">
                <div style="font-weight: bold; margin-bottom: 2px;">{{ department[:3] }}</div>
                <div style="font-size: 0.6rem; opacity: 0.8;">{{ dept_stats[department].total }}</div>
            </div>
            {% endfor %}
            
            <!-- Add Department Button -->
            <div onclick="showAddDepartment()" 
                 style="margin: 15px 0; padding: 0; background: rgba(0, 255, 136, 0.2); 
                        border: 2px solid rgba(0, 255, 136, 0.4); border-radius: 50%; 
                        width: 90px; height: 90px; display: flex; align-items: center; 
                        justify-content: center; cursor: pointer; transition: all 0.3s ease;
                        font-size: 1.5rem; color: #00ff88;">
                <i class="fas fa-plus"></i>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <h1>ADMIN COMMAND CENTER</h1>
            <p>Real-time Employee Status Monitoring</p>
        </div>

        <!-- Navigation Menu -->
        <div class="admin-nav">
            <div class="nav-items">
                <a href="{{ url_for('admin.dashboard') }}" class="nav-item active">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{{ url_for('admin.users') }}" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </a>
                <a href="{{ url_for('admin.messages_whatsapp') }}" class="nav-item">
                    <i class="fas fa-comments"></i>
                    <span>Messages</span>
                </a>
                <a href="{{ url_for('admin.office_layout') }}" class="nav-item">
                    <i class="fas fa-building"></i>
                    <span>Office Layout</span>
                </a>
                <a href="{{ url_for('admin.send_notification') }}" class="nav-item">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </a>
                <a href="{{ url_for('admin.add_user') }}" class="nav-item">
                    <i class="fas fa-user-plus"></i>
                    <span>Add User</span>
                </a>
                <a href="{{ url_for('auth.logout') }}" class="nav-item logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
        
        <!-- Status Legend -->
        <div class="status-legend">
            <div class="legend-item">
                <div class="legend-dot online" style="background-color: #00ff88;"></div>
                <span><i class="fas fa-circle"></i> ONLINE</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot break" style="background-color: #00aaff;"></div>
                <span><i class="fas fa-coffee"></i> BREAK</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot offline" style="background-color: #ff4444;"></div>
                <span><i class="fas fa-power-off"></i> OFFLINE</span>
            </div>
        </div>

        <!-- Floating Office Layout Button -->
        <a href="{{ url_for('admin.office_layout') }}" class="floating-office-btn" title="3D Office Layout View">
            <i class="fas fa-building"></i>
            <span>3D Office</span>
        </a>
        
        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Left Panel - Statistics -->
            <div class="stats-panel">
                <div class="stats-title">SYSTEM STATUS</div>
                
                <div class="stat-item total">
                    <span class="stat-label">
                        <i class="fas fa-users"></i> Total Employees
                    </span>
                    <span class="stat-value" style="color: #00aaff;">{{ total_users }}</span>
                </div>
                
                <div class="stat-item online">
                    <span class="stat-label">
                        <i class="fas fa-circle"></i> Online
                    </span>
                    <span class="stat-value online">{{ online_users }}</span>
                </div>
                
                <div class="stat-item break">
                    <span class="stat-label">
                        <i class="fas fa-coffee"></i> On Break
                    </span>
                    <span class="stat-value break">{{ break_users }}</span>
                </div>
                
                <div class="stat-item offline">
                    <span class="stat-label">
                        <i class="fas fa-power-off"></i> Offline
                    </span>
                    <span class="stat-value offline">{{ offline_users }}</span>
                </div>

                <!-- Department Quick Stats -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(0, 255, 255, 0.2);">
                    <h4 style="color: #00aaff; margin-bottom: 15px; font-size: 1.1rem;">DEPARTMENTS</h4>
                    {% for department in departments %}
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.9rem;">
                        <span>{{ department }}</span>
                        <span style="color: #00aaff;">{{ dept_stats[department].total }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Right Panel - Departments -->
            <div class="departments-container">
                <div class="departments-title">DEPARTMENT OVERVIEW</div>
                <div class="department-grid">
                    {% for department in departments %}
                    <div class="department-panel" data-department="{{ department }}">
                        <div class="department-name">{{ department }}</div>
                        <div style="display: flex; justify-content: space-around; margin-bottom: 15px; font-size: 0.9rem;">
                            <span class="online">{{ dept_stats[department].online }} Online</span>
                            <span class="break">{{ dept_stats[department].break }} Break</span>
                            <span class="offline">{{ dept_stats[department].offline }} Offline</span>
                        </div>
                        <div class="employee-grid">
                            {% for user in user_status_data %}
                            {% if user.department == department %}
                            <div class="employee-desk {{ user.status }}" 
                                 data-user-id="{{ user.id }}"
                                 onclick="showUserDetails({{ user.id }})">
                                <div class="desk-container">
                                    <!-- Status Light -->
                                    <div class="status-light"></div>
                                    
                                    <!-- Desk -->
                                    <div class="desk"></div>
                                    
                                    <!-- Computer Monitor -->
                                    <div class="monitor"></div>
                                    
                                    <!-- Keyboard -->
                                    <div class="keyboard"></div>
                                    
                                    <!-- Mouse -->
                                    <div class="mouse"></div>
                                    
                                    <!-- Chair -->
                                    <div class="chair"></div>
                                    
                                    <!-- Avatar -->
                                    <div class="avatar">
                                        <div class="avatar-head" data-user-id="{{ user.id }}">
                                            <div class="avatar-initials">{{ user.username[:2].upper() }}</div>
                                        </div>
                                        <div class="avatar-body"></div>
                                    </div>
                                </div>
                                
                                <!-- Employee Name Label -->
                                <div style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); 
                                           font-size: 0.7rem; color: #00aaff; text-align: center; white-space: nowrap;
                                           text-shadow: 0 0 5px rgba(0, 170, 255, 0.8);">
                                    {{ user.username }}
                                </div>
                                
                                <!-- Tooltip -->
                                <div class="employee-tooltip">
                                    <strong>{{ user.username }}</strong><br>
                                    Department: {{ user.department }}<br>
                                    Status: {{ user.status.upper() }}<br>
                                    {% if user.last_activity %}
                                    Last Activity: {{ user.last_activity[:16] }}
                                    {% else %}
                                    Never logged in
                                    {% endif %}
                                    {% if user.last_login %}
                                    <br>Last Login: {{ user.last_login[:16] }}
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        

    </div>

    <script>
        let autoRefreshEnabled = true;
        let refreshInterval;
        
        // Create floating particles
        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 80;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                container.appendChild(particle);
            }
        }
        
        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
        }
        
        // Show user details
        function showUserDetails(userId) {
            const userInfo = {{ user_status_data | tojson }};
            const user = userInfo.find(u => u.id == userId);
            
            if (user) {
                // Create a more stylish modal instead of alert
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0, 0, 0, 0.8); z-index: 10000; 
                    display: flex; align-items: center; justify-content: center;
                `;
                
                modal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #0a0a0a, #1a1a2e); 
                                border: 2px solid #00aaff; border-radius: 15px; 
                                padding: 30px; max-width: 400px; color: white;
                                box-shadow: 0 0 50px rgba(0, 170, 255, 0.5);">
                        <h2 style="color: #00aaff; margin-bottom: 20px; text-align: center;">
                            <i class="fas fa-user-circle"></i> EMPLOYEE PROFILE
                        </h2>
                        <div style="line-height: 1.8;">
                            <p><strong>Name:</strong> ${user.username}</p>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Department:</strong> ${user.department}</p>
                            <p><strong>Status:</strong> 
                                <span style="color: ${user.status === 'online' ? '#00ff88' : 
                                                   user.status === 'break' ? '#00aaff' : '#ff4444'}">
                                    ${user.status.toUpperCase()}
                                </span>
                            </p>
                            <p><strong>Last Activity:</strong> ${user.last_activity || 'Never'}</p>
                            <p><strong>Last Login:</strong> ${user.last_login || 'Never'}</p>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button onclick="sendQuickMessage(${user.id}, '${user.username}')" 
                                    style="flex: 1; padding: 10px 15px; background: linear-gradient(135deg, #00ff88, #00aaff); 
                                           border: none; border-radius: 5px; color: white; cursor: pointer; font-weight: bold;">
                                <i class="fas fa-envelope"></i> SEND MESSAGE
                            </button>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                    style="flex: 1; padding: 10px 15px; background: rgba(255, 255, 255, 0.1); 
                                           border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 5px; 
                                           color: white; cursor: pointer;">
                                CLOSE
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.remove();
                });
            }
        }

        // Focus on specific department
        function focusDepartment(department) {
            const departmentPanel = document.querySelector(`[data-department="${department}"]`);
            if (departmentPanel) {
                departmentPanel.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Highlight effect
                departmentPanel.style.transform = 'scale(1.05)';
                departmentPanel.style.boxShadow = '0 0 50px rgba(0, 255, 255, 0.8)';
                
                setTimeout(() => {
                    departmentPanel.style.transform = '';
                    departmentPanel.style.boxShadow = '';
                }, 2000);
            }
        }

        // Show add department modal
        function showAddDepartment() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 10000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #0a0a0a, #1a1a2e); 
                            border: 2px solid #00aaff; border-radius: 15px; 
                            padding: 30px; max-width: 400px; color: white;
                            box-shadow: 0 0 50px rgba(0, 170, 255, 0.5);">
                    <h2 style="color: #00aaff; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-building"></i> DEPARTMENT MANAGEMENT
                    </h2>
                    <div style="margin-bottom: 20px;">
                        <button onclick="window.location.href='{{ url_for('admin.add_user') }}'" 
                                style="width: 100%; padding: 15px; background: linear-gradient(135deg, #00ff88, #00aaff); 
                                       border: none; border-radius: 8px; color: white; cursor: pointer; margin-bottom: 10px;
                                       font-weight: bold;">
                            <i class="fas fa-user-plus"></i> ADD NEW USER
                        </button>
                        <button onclick="showUserAssignment()" 
                                style="width: 100%; padding: 15px; background: linear-gradient(135deg, #00aaff, #0088cc); 
                                       border: none; border-radius: 8px; color: white; cursor: pointer; margin-bottom: 10px;
                                       font-weight: bold;">
                            <i class="fas fa-exchange-alt"></i> ASSIGN DEPARTMENTS
                        </button>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.1); 
                                   border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 5px; 
                                   color: white; cursor: pointer;">
                        CLOSE
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Show user assignment modal
        function showUserAssignment() {
            const userInfo = {{ user_status_data | tojson }};
            const departments = {{ departments | tojson }};
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 10000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            let userOptions = userInfo.map(user => 
                `<option value="${user.id}">${user.username} (${user.department})</option>`
            ).join('');
            
            let deptOptions = departments.map(dept => 
                `<option value="${dept}">${dept}</option>`
            ).join('');
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #0a0a0a, #1a1a2e); 
                            border: 2px solid #00aaff; border-radius: 15px; 
                            padding: 30px; max-width: 500px; color: white;
                            box-shadow: 0 0 50px rgba(0, 170, 255, 0.5);">
                    <h2 style="color: #00aaff; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-exchange-alt"></i> ASSIGN USER TO DEPARTMENT
                    </h2>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; color: #00aaff;">Select User:</label>
                        <select id="assignUser" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.5); 
                                                      border: 1px solid #00aaff; border-radius: 5px; color: white;">
                            <option value="">Choose User</option>
                            ${userOptions}
                        </select>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; color: #00aaff;">Select Department:</label>
                        <select id="assignDept" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.5); 
                                                      border: 1px solid #00aaff; border-radius: 5px; color: white;">
                            <option value="">Choose Department</option>
                            ${deptOptions}
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="assignUserToDepartment()" 
                                style="flex: 1; padding: 12px; background: linear-gradient(135deg, #00ff88, #00aaff); 
                                       border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                            ASSIGN
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.1); 
                                       border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; 
                                       color: white; cursor: pointer;">
                            CANCEL
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Assign user to department
        function assignUserToDepartment() {
            const userId = document.getElementById('assignUser').value;
            const department = document.getElementById('assignDept').value;
            
            if (!userId || !department) {
                FAlert.warning('Please select both user and department');
                return;
            }
            
            fetch('/admin/assign-department', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userId,
                    department: department
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    FAlert.success('User assigned successfully!');
                    setTimeout(() => window.location.reload(), 1500);
                } else {
                    FAlert.error('Failed to assign user: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                FAlert.error('Error assigning user');
            });
        }
        
        // Send broadcast notification
        function sendBroadcast() {
            const title = prompt('Enter notification title:');
            if (!title) return;
            
            const message = prompt('Enter notification message:');
            if (!message) return;
            
            fetch('/admin/api/broadcast-notification', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    title: title,
                    message: message,
                    type: 'alert'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    FAlert.success('Notification sent successfully!');
                } else {
                    FAlert.error('Failed to send notification: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                FAlert.error('Error sending notification');
            });
        }
        
        // Toggle auto-refresh
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const icon = document.getElementById('refreshIcon');
            const text = document.getElementById('refreshText');
            const status = document.getElementById('refreshStatus');
            
            if (autoRefreshEnabled) {
                icon.className = 'fas fa-pause';
                text.textContent = 'Pause';
                status.textContent = 'ON';
                startAutoRefresh();
            } else {
                icon.className = 'fas fa-play';
                text.textContent = 'Resume';
                status.textContent = 'PAUSED';
                stopAutoRefresh();
            }
        }
        
        // Auto-refresh functionality
        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(() => {
                if (autoRefreshEnabled) {
                    document.body.style.opacity = '0.8';
                    setTimeout(() => {
                        window.location.reload();
                    }, 300);
                }
            }, 15000); // 15 seconds
        }
        
        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        }
        
        // 3D mouse effects
        document.addEventListener('mousemove', function(e) {
            const panels = document.querySelectorAll('.department-panel');
            const mouseX = e.clientX / window.innerWidth;
            const mouseY = e.clientY / window.innerHeight;
            
            panels.forEach(panel => {
                const rect = panel.getBoundingClientRect();
                const panelX = (rect.left + rect.width / 2) / window.innerWidth;
                const panelY = (rect.top + rect.height / 2) / window.innerHeight;
                
                const deltaX = (mouseX - panelX) * 5;
                const deltaY = (mouseY - panelY) * 5;
                
                panel.style.transform = `perspective(1000px) rotateY(${deltaX}deg) rotateX(${-deltaY}deg)`;
            });
        });
        
        // Load user faces
        function loadUserFaces() {
            const avatarHeads = document.querySelectorAll('.avatar-head[data-user-id]');
            
            avatarHeads.forEach(avatarHead => {
                const userId = avatarHead.dataset.userId;
                
                fetch(`/admin/api/user-face/${userId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success && data.face_data) {
                            // Create image element
                            const img = document.createElement('img');
                            img.src = data.face_data;
                            img.className = 'avatar-face';
                            img.onerror = function() {
                                // If image fails to load, keep initials
                                console.log('Failed to load face for user', userId);
                            };
                            
                            // Replace initials with face image
                            avatarHead.innerHTML = '';
                            avatarHead.appendChild(img);
                        }
                    })
                    .catch(error => {
                        console.log('Error loading face for user', userId, error);
                    });
            });
        }

        // Live messaging system
        let messagePollingInterval;
        
        function startMessagePolling() {
            messagePollingInterval = setInterval(() => {
                fetch('/admin/api/messages')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            updateMessageNotifications(data.messages);
                        }
                    })
                    .catch(error => console.log('Message polling error:', error));
            }, 5000); // Poll every 5 seconds
        }
        
        function updateMessageNotifications(messages) {
            // Update notification count or display
            const unreadCount = messages.filter(msg => !msg.is_read).length;
            
            // Update message count display
            const messageCountEl = document.getElementById('messageCount');
            if (messageCountEl) {
                messageCountEl.textContent = unreadCount;
                messageCountEl.style.color = unreadCount > 0 ? '#ff4444' : '#00ff88';
            }
        }

        // Show message center
        function showMessageCenter() {
            fetch('/admin/api/messages')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayMessageCenter(data.messages);
                    }
                })
                .catch(error => {
                    console.error('Error loading messages:', error);
                });
        }

        function displayMessageCenter(messages) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 10000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            let messageList = messages.map(msg => `
                <div style="padding: 15px; margin: 10px 0; background: rgba(0, 0, 0, 0.3); 
                           border-radius: 8px; border-left: 4px solid ${msg.is_read ? '#00aaff' : '#ff4444'};">
                    <div style="font-weight: bold; color: #00aaff; margin-bottom: 5px;">
                        ${msg.title} - ${msg.username}
                    </div>
                    <div style="margin-bottom: 5px;">${msg.message}</div>
                    <div style="font-size: 0.8rem; opacity: 0.7;">
                        ${new Date(msg.created_at).toLocaleString()}
                    </div>
                </div>
            `).join('');
            
            if (messages.length === 0) {
                messageList = '<div style="text-align: center; padding: 40px; opacity: 0.7;">No messages yet</div>';
            }
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #0a0a0a, #1a1a2e); 
                            border: 2px solid #00aaff; border-radius: 15px; 
                            padding: 30px; max-width: 600px; max-height: 80vh; color: white;
                            box-shadow: 0 0 50px rgba(0, 170, 255, 0.5); overflow-y: auto;">
                    <h2 style="color: #00aaff; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-comments"></i> MESSAGE CENTER
                    </h2>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${messageList}
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.1); 
                                   border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; 
                                   color: white; cursor: pointer; margin-top: 20px;">
                        CLOSE
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Quick message function
        function sendQuickMessage(userId, username) {
            const message = prompt(`Send message to ${username}:`);
            if (!message) return;
            
            fetch('/admin/api/send-message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userId,
                    message: message
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    FAlert.success(data.message, 'Message Sent');
                } else {
                    FAlert.error(data.message, 'Error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                FAlert.error('Failed to send message');
            });
        }

        // Show notification function
        function showNotification(title, message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 10000;
                background: rgba(0, 0, 0, 0.9); border: 2px solid;
                border-radius: 10px; padding: 15px 20px; color: white;
                min-width: 300px; animation: slideIn 0.3s ease-out;
            `;
            
            if (type === 'success') {
                notification.style.borderColor = '#00ff88';
            } else if (type === 'error') {
                notification.style.borderColor = '#ff4444';
            } else {
                notification.style.borderColor = '#00aaff';
            }
            
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Broadcast Alert Functions
        function showBroadcastAlert() {
            document.getElementById('broadcastModal').style.display = 'flex';
        }

        function closeBroadcastAlert() {
            document.getElementById('broadcastModal').style.display = 'none';
            // Reset form
            document.getElementById('alertType').value = 'info';
            document.getElementById('alertMessage').value = '';
            document.getElementById('alertTarget').value = 'all';
        }

        function sendBroadcastAlert() {
            const alertType = document.getElementById('alertType').value;
            const message = document.getElementById('alertMessage').value.trim();
            const target = document.getElementById('alertTarget').value;

            if (!message) {
                FAlert.warning('Please enter a message');
                return;
            }

            const alertData = {
                type: alertType,
                message: message,
                target: target,
                title: getAlertTitle(alertType)
            };

            fetch('/admin/api/broadcast-alert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(alertData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    FAlert.success('Alert broadcasted successfully!');
                    closeBroadcastAlert();
                } else {
                    FAlert.error(data.message || 'Failed to send alert');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                FAlert.error('Failed to send alert');
            });
        }

        function getAlertTitle(type) {
            const titles = {
                'info': 'Information',
                'warning': 'Warning',
                'urgent': 'Urgent Alert',
                'emergency': 'EMERGENCY'
            };
            return titles[type] || 'Alert';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            updateTimestamp();
            loadUserFaces();
            startAutoRefresh();
            startMessagePolling();
            
            // Update timestamp every second
            setInterval(updateTimestamp, 1000);
            
            // Close modal when clicking outside
            document.getElementById('broadcastModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeBroadcastAlert();
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'r' && e.ctrlKey) {
                    e.preventDefault();
                    window.location.reload();
                }
                if (e.key === ' ') {
                    e.preventDefault();
                    toggleAutoRefresh();
                }
                if (e.key === 'Escape') {
                    closeBroadcastAlert();
                }
            });
        });
    </script>
</body>
</html>
